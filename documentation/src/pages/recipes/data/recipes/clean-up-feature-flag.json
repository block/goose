{
    "id": "clean-up-feature-flag",
    "title": "Clean Up Feature Flag",
    "description": "Automatically clean up all references of a fully rolled out feature flag from a codebase and make the new behavior the default.",
    "instructions": "Your job is to systematically remove a fully rolled out feature flag and ensure the new behavior is now the default. Use code search tools like ripgrep to identify all references to the flag, clean up definition files, usage sites, tests, and configuration files. Then create a commit and push changes with clear commit messages documenting the flag removal.",
    "prompt": "Task: Remove a feature flag that has been fully rolled out, where the feature flag's functionality should become the default behavior.\n\nContext:\n\nFeature flag key: {{feature_flag_key}}\nProject: {{repo_dir}}\nFeature is fully rolled out and stable, meaning the feature flag is always evaluated to true or Treatment, etc.\n\nSteps to follow:\n\n1. Check out a *new* branch from main or master named using the feature flag key.\n2. Find the feature flag constant/object that wraps the key.\n3. Search for all references to the constant/object using ripgrep or equivalent tools.\n4. For each file that contains references:\n   - **Definition files**: Remove the flag definition and related imports.\n   - **Usage sites**: Remove conditional logic and default to the new behavior. Clean up related imports.\n   - **Test files**: Remove tests that cover the 'disabled' state of the flag and update remaining ones. Clean up mocks and imports.\n   - **Configuration files**: Remove entries related to the feature flag.\n5. Re-run a full-text search to ensure all references (and imports) are removed.\n6. Clean up now-unused variables or functions introduced solely for the flag.\n7. Double-check for and remove any leftover imports or dead code.\n8. Create a commit with **only the files affected by this cleanup** (donâ€™t use `git add .`).\n9. Push the branch to origin.\n10. Open a GitHub PR using: `https://github.com/squareup/<repo-name>/compare/<branch-name>` and replace the repo and branch placeholders.\n\nUse clear commit messages like:\n```\nchore(flag-cleanup): remove <feature_flag_key> flag from codebase\n```\nExplain the flag was fully rolled out and the new behavior is now default.",
    "action": "Remove Feature Flag",
    "category": "Developer",
    "extensions": ["Developer"],
    "activities": [
      "Remove feature flag definitions",
      "Clean up feature flag usage sites",
      "Update affected tests",
      "Remove flag configurations",
      "Document flag removal"
    ],
    "recipeUrl": "goose://recipe?config=ewogICAgImlkIjogImNsZWFuLXVwLWZlYXR1cmUtZmxhZyIsCiAgICAidGl0bGUiOiAiQ2xlYW4gVXAgRmVhdHVyZSBGbGFnIiwKICAgICJkZXNjcmlwdGlvbiI6ICJBdXRvbWF0aWNhbGx5IGNsZWFuIHVwIGFsbCByZWZlcmVuY2VzIG9mIGEgZnVsbHkgcm9sbGVkIG91dCBmZWF0dXJlIGZsYWcgZnJvbSBhIGNvZGViYXNlIGFuZCBtYWtlIHRoZSBuZXcgYmVoYXZpb3IgdGhlIGRlZmF1bHQuIiwKICAgICJpbnN0cnVjdGlvbnMiOiAiWW91ciBqb2IgaXMgdG8gc3lzdGVtYXRpY2FsbHkgcmVtb3ZlIGEgZnVsbHkgcm9sbGVkIG91dCBmZWF0dXJlIGZsYWcgYW5kIGVuc3VyZSB0aGUgbmV3IGJlaGF2aW9yIGlzIG5vdyB0aGUgZGVmYXVsdC4gVXNlIGNvZGUgc2VhcmNoIHRvb2xzIGxpa2UgcmlwZ3JlcCB0byBpZGVudGlmeSBhbGwgcmVmZXJlbmNlcyB0byB0aGUgZmxhZywgY2xlYW4gdXAgZGVmaW5pdGlvbiBmaWxlcywgdXNhZ2Ugc2l0ZXMsIHRlc3RzLCBhbmQgY29uZmlndXJhdGlvbiBmaWxlcy4gVGhlbiBjcmVhdGUgYSBjb21taXQgYW5kIHB1c2ggY2hhbmdlcyB3aXRoIGNsZWFyIGNvbW1pdCBtZXNzYWdlcyBkb2N1bWVudGluZyB0aGUgZmxhZyByZW1vdmFsLiIsCiAgICAicHJvbXB0IjogIlRhc2s6IFJlbW92ZSBhIGZlYXR1cmUgZmxhZyB0aGF0IGhhcyBiZWVuIGZ1bGx5IHJvbGxlZCBvdXQsIHdoZXJlIHRoZSBmZWF0dXJlIGZsYWcncyBmdW5jdGlvbmFsaXR5IHNob3VsZCBiZWNvbWUgdGhlIGRlZmF1bHQgYmVoYXZpb3IuXG5cbkNvbnRleHQ6XG5cbkZlYXR1cmUgZmxhZyBrZXk6IHt7ZmVhdHVyZV9mbGFnX2tleX19XG5Qcm9qZWN0OiB7e3JlcG9fZGlyfX1cbkZlYXR1cmUgaXMgZnVsbHkgcm9sbGVkIG91dCBhbmQgc3RhYmxlLCBtZWFuaW5nIHRoZSBmZWF0dXJlIGZsYWcgaXMgYWx3YXlzIGV2YWx1YXRlZCB0byB0cnVlIG9yIFRyZWF0bWVudCwgZXRjLlxuXG5TdGVwcyB0byBmb2xsb3c6XG5cbjEuIENoZWNrIG91dCBhICpuZXcqIGJyYW5jaCBmcm9tIG1haW4gb3IgbWFzdGVyIG5hbWVkIHVzaW5nIHRoZSBmZWF0dXJlIGZsYWcga2V5LlxuMi4gRmluZCB0aGUgZmVhdHVyZSBmbGFnIGNvbnN0YW50L29iamVjdCB0aGF0IHdyYXBzIHRoZSBrZXkuXG4zLiBTZWFyY2ggZm9yIGFsbCByZWZlcmVuY2VzIHRvIHRoZSBjb25zdGFudC9vYmplY3QgdXNpbmcgcmlwZ3JlcCBvciBlcXVpdmFsZW50IHRvb2xzLlxuNC4gRm9yIGVhY2ggZmlsZSB0aGF0IGNvbnRhaW5zIHJlZmVyZW5jZXM6XG4gICAtICoqRGVmaW5pdGlvbiBmaWxlcyoqOiBSZW1vdmUgdGhlIGZsYWcgZGVmaW5pdGlvbiBhbmQgcmVsYXRlZCBpbXBvcnRzLlxuICAgLSAqKlVzYWdlIHNpdGVzKio6IFJlbW92ZSBjb25kaXRpb25hbCBsb2dpYyBhbmQgZGVmYXVsdCB0byB0aGUgbmV3IGJlaGF2aW9yLiBDbGVhbiB1cCByZWxhdGVkIGltcG9ydHMuXG4gICAtICoqVGVzdCBmaWxlcyoqOiBSZW1vdmUgdGVzdHMgdGhhdCBjb3ZlciB0aGUgJ2Rpc2FibGVkJyBzdGF0ZSBvZiB0aGUgZmxhZyBhbmQgdXBkYXRlIHJlbWFpbmluZyBvbmVzLiBDbGVhbiB1cCBtb2NrcyBhbmQgaW1wb3J0cy5cbiAgIC0gKipDb25maWd1cmF0aW9uIGZpbGVzKio6IFJlbW92ZSBlbnRyaWVzIHJlbGF0ZWQgdG8gdGhlIGZlYXR1cmUgZmxhZy5cbjUuIFJlLXJ1biBhIGZ1bGwtdGV4dCBzZWFyY2ggdG8gZW5zdXJlIGFsbCByZWZlcmVuY2VzIChhbmQgaW1wb3J0cykgYXJlIHJlbW92ZWQuXG42LiBDbGVhbiB1cCBub3ctdW51c2VkIHZhcmlhYmxlcyBvciBmdW5jdGlvbnMgaW50cm9kdWNlZCBzb2xlbHkgZm9yIHRoZSBmbGFnLlxuNy4gRG91YmxlLWNoZWNrIGZvciBhbmQgcmVtb3ZlIGFueSBsZWZ0b3ZlciBpbXBvcnRzIG9yIGRlYWQgY29kZS5cbjguIENyZWF0ZSBhIGNvbW1pdCB3aXRoICoqb25seSB0aGUgZmlsZXMgYWZmZWN0ZWQgYnkgdGhpcyBjbGVhbnVwKiogKGRvbuKAmXQgdXNlIGBnaXQgYWRkIC5gKS5cbjkuIFB1c2ggdGhlIGJyYW5jaCB0byBvcmlnaW4uXG4xMC4gT3BlbiBhIEdpdEh1YiBQUiB1c2luZzogYGh0dHBzOi8vZ2l0aHViLmNvbS9zcXVhcmV1cC88cmVwby1uYW1lPi9jb21wYXJlLzxicmFuY2gtbmFtZT5gIGFuZCByZXBsYWNlIHRoZSByZXBvIGFuZCBicmFuY2ggcGxhY2Vob2xkZXJzLlxuXG5Vc2UgY2xlYXIgY29tbWl0IG1lc3NhZ2VzIGxpa2U6XG5gYGBcbmNob3JlKGZsYWctY2xlYW51cCk6IHJlbW92ZSA8ZmVhdHVyZV9mbGFnX2tleT4gZmxhZyBmcm9tIGNvZGViYXNlXG5gYGBcbkV4cGxhaW4gdGhlIGZsYWcgd2FzIGZ1bGx5IHJvbGxlZCBvdXQgYW5kIHRoZSBuZXcgYmVoYXZpb3IgaXMgbm93IGRlZmF1bHQuIiwKICAgICJhY3Rpb24iOiAiUmVtb3ZlIEZlYXR1cmUgRmxhZyIsCiAgICAiY2F0ZWdvcnkiOiAiRGV2ZWxvcGVyIiwKICAgICJleHRlbnNpb25zIjogWyJEZXZlbG9wZXIiXSwKICAgICJhY3Rpdml0aWVzIjogWwogICAgICAiUmVtb3ZlIGZlYXR1cmUgZmxhZyBkZWZpbml0aW9ucyIsCiAgICAgICJDbGVhbiB1cCBmZWF0dXJlIGZsYWcgdXNhZ2Ugc2l0ZXMiLAogICAgICAiVXBkYXRlIGFmZmVjdGVkIHRlc3RzIiwKICAgICAgIlJlbW92ZSBmbGFnIGNvbmZpZ3VyYXRpb25zIiwKICAgICAgIkRvY3VtZW50IGZsYWcgcmVtb3ZhbCIKICAgIF0sCiAgICAicmVjaXBlVXJsIjogImdvb3NlOi8vcmVjaXBlP2NvbmZpZz1leUpwWkNJNkltTnNaV0Z1TFhWd0xXWmxZWFIxY21VdFpteGhaeUlzSW5ScGRHeGxJam9pUTJ4bFlXNGdWWEFnUm1WaGRIVnlaU0JHYkdGbklpd2laR1Z6WTNKcGNIUnBiMjRpT2lKQmRYUnZiV0YwYVdOaGJHeDVJR05zWldGdUlIVndJR0ZzYkNCeVpXWmxjbVZ1WTJWeklHOW1JR0VnWm5Wc2JIa2djbTlzYkdWa0lHOTFkQ0JtWldGMGRYSmxJR1pzWVdjZ1puSnZiU0JoSUdOdlpHVmlZWE5sSUdGdVpDQnRZV3RsSUhSb1pTQnVaWGNnWW1Wb1lYWnBiM0lnZEdobElHUmxabUYxYkhRdUlpd2lhVzUiLAogICAgImF1dGhvciI6ICJhbWl0ZGV2IgogIH0=",
    "author": "amitdev"
  }
  
  