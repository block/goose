---
title: "Architecture Review: A2A Spec Compliance & Multi-Agent Backend"
type: review
date: 2026-02-17
confidence: 0.95
tags: [a2a, spec-compliance, architecture, review]
---

# Architecture Review: A2A Spec Compliance & Multi-Agent Backend

## Session: 2026-02-17 (Backend Track)

### Scope
Full A2A specification compliance audit + multi-agent infrastructure implementation.

### Reference Sources
1. **a2a.proto** (814 lines) — `/home/jmercier/codes/A2A/specification/a2a.proto`
2. **specification.md** (3513 lines) — `/home/jmercier/codes/A2A/docs/specification.md`
3. **a2a-js SDK v0.3.10** — `/home/jmercier/codes/a2a-js/`
4. **ADR-001** — `/home/jmercier/codes/A2A/adrs/adr-001-protojson-serialization.md`

### Compliance Matrix

| Category | Item | Status | File |
|----------|------|--------|------|
| Enums | TaskState SCREAMING_SNAKE_CASE | ✅ Fixed | `a2a/types/core.rs` |
| Enums | Role SCREAMING_SNAKE_CASE | ✅ Fixed | `a2a/types/core.rs` |
| Enums | Unspecified variants | ✅ Added | `a2a/types/core.rs` |
| Enums | Lenient deser (legacy compat) | ✅ Added | `a2a/types/core.rs` |
| Methods | PascalCase JSON-RPC names | ✅ Fixed | `a2a/jsonrpc.rs` |
| Methods | Legacy slash-style accepted | ✅ Added | `server/transport/jsonrpc_handler.rs` |
| Errors | All 9 error codes (-32001→-32009) | ✅ Complete | `a2a/error.rs` |
| Types | AgentCard | ✅ Correct | `a2a/types/agent_card.rs` |
| Types | SecurityScheme | ✅ Correct | `a2a/types/security.rs` |
| Types | Extensions | ✅ Correct | `a2a/types/extensions.rs` |
| Binding | JSON-RPC | ✅ Implemented | `server/transport/` |
| Binding | REST (HTTP+JSON) | ❌ Not implemented | Low priority |

### Architecture Decisions

**ADR: Lenient Deserialization**
- Serialize: always SCREAMING_SNAKE_CASE (spec-correct)
- Deserialize: accept both SCREAMING_SNAKE_CASE and lowercase (JS SDK compat)
- Rationale: Spec Appendix A migration timeline allows both through 0.5.x

**ADR: Dispatcher Trait Pattern**
- `Dispatcher` trait with `dispatch_one()` and `dispatch_all()` methods
- Three implementations: InProcess, A2A, Composite
- Decoupled from OrchestratorAgent for testability and future extension

**ADR: Unified Agent Catalog**
- Single `GET /agents/catalog` endpoint merges builtin + external + A2A agents
- Enables Platform zone UI to display all agent types uniformly
- Uses `CatalogAgentKind` enum for type discrimination

**ADR: SlotDelegation Per-Agent Strategy**
- Each agent slot has an `InProcess`, `ExternalAcp`, or `RemoteA2A { url }` strategy
- Strategy set during agent connect/disconnect lifecycle
- Enables per-slot dispatch routing in compound execution

### Test Coverage

| Crate | Tests | Status |
|-------|-------|--------|
| a2a | 115 (77 unit + 38 integration) | ✅ |
| goose | 891 | ✅ |
| goose-server | 57 | ✅ |
| **Total** | **1,063** | **✅ All passing** |

### Files Modified (Backend Track)

```
crates/a2a/src/types/core.rs          — ProtoJSON enums, lenient deser
crates/a2a/src/jsonrpc.rs             — PascalCase method names
crates/a2a/src/error.rs               — 4 new error codes
crates/a2a/src/server/transport/jsonrpc_handler.rs — legacy method compat
crates/a2a/tests/spec_compliance.rs   — updated assertions + legacy tests
crates/goose/src/agents/dispatch.rs   — NEW: Dispatcher trait
crates/goose/src/agents/mod.rs        — dispatch module registration
crates/goose/src/agents/orchestration/mod.rs — dispatch re-exports
crates/goose-server/src/routes/agent_management.rs — catalog endpoint + ACP wiring
crates/goose-server/src/routes/observatory.rs — NEW: 3 observatory endpoints
crates/goose-server/src/routes/reply.rs — compound fan-out + dynamic sync
crates/goose-server/src/agent_slot_registry.rs — SlotDelegation + methods
crates/goose-server/src/openapi.rs    — catalog + observatory types
```

### Risks

| Risk | Severity | Mitigation |
|------|----------|------------|
| JS SDK sends lowercase enums | Medium | Lenient deser handles both |
| Pipeline module breaks build | High | Commented out, frontend agent must fix |
| Compound execution is sequential | Low | Phase 2: parallel AgentPool dispatch |
| No user identity model | Medium | Proposal written, Phase 1 is low-risk |
