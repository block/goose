# A2A Spec Verification Report

## Overview

Comprehensive verification of Goose's A2A implementation against the A2A v1.0 RC specification (proto + JSON wire format).

**Date**: 2025-02-17  
**Test count**: 106 total (72 lib + 34 spec compliance integration)  
**Result**: ✅ PASS — all wire format tests pass

## Test Coverage Matrix

| Spec Area | Lib Tests | Integration Tests | Status |
|-----------|-----------|-------------------|--------|
| TaskState (8 values) | 3 | 3 | ✅ |
| Role enum | 0 | 1 | ✅ |
| Message | 1 | 1 | ✅ |
| Part / PartContent | 3 | 3 | ✅ |
| Task | 1 | 3 | ✅ |
| Artifact | 1 | 1 | ✅ |
| SendMessageRequest | 0 | 1 | ✅ |
| JSON-RPC envelopes | 3 | 2 | ✅ |
| Method constants | 0 | 1 | ✅ |
| A2AError codes | 3 | 2 | ✅ |
| AgentCard | 2 | 3 | ✅ |
| StreamResponse | 0 | 2 | ✅ |
| SecurityScheme | 2 | 3 | ✅ |
| PushNotificationConfig | 1 | 1 | ✅ |
| Request types | 1 | 1 | ✅ |
| Roundtrip tests | 2 | 2 | ✅ |
| **Server routes** | **10** | — | ✅ |
| **Goose adapter** | **5** | — | ✅ |
| **Delegation** | **12** | — | ✅ |

## Known Spec Gaps (Accepted)

| Gap | Impact | Rationale |
|-----|--------|-----------|
| `SecurityRequirement` type | Low | Uses `serde_json::Value` catch-all — adequate for current needs |
| `StringList` wrapper | None | Only used inside SecurityRequirement |
| `ImplicitOAuthFlow` | None | **Deprecated** in proto spec |
| `PasswordOAuthFlow` | None | **Deprecated** in proto spec |
| `ApiKeySecurityScheme.location` not renamed to `"in"` | Low | Divergence from OpenAPI convention; our wire format uses `"location"` |

## Proto Coverage

| Proto Messages | Count | Implemented | Percentage |
|----------------|-------|-------------|------------|
| Total defined | 46 | 42 | 91% |
| Enums | 2 | 2 | 100% |
| Service | 1 | 1 (HTTP) | 100% |
| Missing | 4 | — | Accepted gaps above |

## Wire Format Verification

All tests verify **camelCase** JSON serialization (matching the spec) including:
- Field names: `messageId`, `contextId`, `taskId`, `artifactId`, `referenceTaskIds`
- Enum discriminators: `"type"` tag for SecurityScheme, `"kind"` tag for StreamResponse
- Nested structures: `TaskStatus.message` as `Box<Message>`, `Part.content` as tagged enum
- Default handling: `#[serde(default)]` for optional arrays and booleans
- Skip serialization: `#[serde(skip_serializing_if)]` for None fields

## Architecture Verification

| Component | File | Tests | Notes |
|-----------|------|-------|-------|
| A2A types | `crates/a2a/src/types/` | 72 | Hand-written serde matching proto |
| A2A server | `crates/a2a/src/server/` | Included in lib | Traits + InMemory implementations |
| A2A client | `crates/a2a/src/client/` | Included in lib | reqwest-based HTTP client |
| Goose adapter | `crates/goose/src/a2a_compat/` | 5 | Message conversion + executor |
| Server routes | `crates/goose-server/src/routes/a2a.rs` | 10 | Aggregated + per-persona + instances |
| Delegation | `crates/goose/src/agents/delegation.rs` | 12 | RemoteA2AAgent strategy |

## Recommendations

1. **Consider renaming** `ApiKeySecurityScheme.location` → `in` with `#[serde(rename = "in")]` for full OpenAPI compatibility
2. **Add** `SecurityRequirement` and `StringList` types when agent card security features are needed
3. **Add** end-to-end integration test with real HTTP transport (currently mocked)
4. **Wire** instance routes to full JSON-RPC/SSE transport (goose4-f7fr)
