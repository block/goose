<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Goose App Container</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    iframe {
      border: none;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
<iframe id="app-frame" sandbox="allow-scripts"></iframe>
<script>
  const iframe = document.getElementById('app-frame');

  window.__gooseMCP.getAppHtml().then(html => {
    iframe.srcdoc = html;
  });

  window.addEventListener('message', async (event) => {
    if (event.source !== iframe.contentWindow) return;
    const msg = event.data;
    if (!msg || msg.jsonrpc !== '2.0') return;

    console.log('Container received MCP request:', msg);

    try {
      const result = await window.__gooseMCP.handleRequest(msg);
      if (msg.id) {
        iframe.contentWindow.postMessage({
          jsonrpc: '2.0',
          id: msg.id,
          result
        }, '*');
      }
    } catch (error) {
      console.error('MCP request failed:', error);
      if (msg.id) {
        iframe.contentWindow.postMessage({
          jsonrpc: '2.0',
          id: msg.id,
          error: { code: -32000, message: error.message || 'Request failed' }
        }, '*');
      }
    }
  });
</script>
</body>
</html>