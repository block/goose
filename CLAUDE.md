# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Goose is an open-source AI agent built in Rust that automates engineering tasks through a combination of tool execution, file manipulation, and shell command interaction. The project consists of multiple Rust crates for core functionality, a CLI interface, and an Electron-based desktop application.

## Architecture

The codebase follows a modular architecture with clear separation of concerns:

- **Core Libraries**: Located in `crates/` directory
  - `goose/`: Core agent functionality, providers, tools, and extensions
  - `goose-cli/`: Command-line interface and user interaction
  - `goose-server/`: HTTP server for desktop app integration
  - `goose-llm/`: LLM abstraction layer and provider implementations
  - `goose-mcp/`: Model Context Protocol (MCP) server implementations
  - `mcp-*`: MCP core functionality, client, server, and macros

- **Extensions System**: Goose uses an extension-based architecture where capabilities are added through tools and state management. Extensions can depend on each other and provide specialized functionality.

- **Desktop Application**: Located in `ui/desktop/` - React/TypeScript Electron app that provides a GUI interface to the Rust backend

## Common Development Commands

### Building and Running

```bash
# Build all Rust components
cargo build

# Build release version
cargo build --release

# Run CLI directly (development)
./target/debug/goose --help
./target/debug/goose configure
./target/debug/goose session

# Using just for common tasks (recommended)
just release-binary          # Build release and copy binaries
just run-ui                  # Build and run desktop app
just run-ui-dev             # Build debug version and run UI
just run-server             # Run HTTP server only
```

### Development Workflow

```bash
# Code quality checks
cargo check                 # Quick compilation check
cargo test                  # Run all tests
cargo fmt                   # Format code
cargo clippy               # Run linter

# Desktop app development
cd ui/desktop
npm install                # Install dependencies
npm run typecheck          # TypeScript checking
npm run lint:check         # Lint TypeScript code
npm run test-e2e          # Run Playwright tests
npm run generate-api       # Regenerate API client from OpenAPI spec
```

### Testing

```bash
# Run Rust tests
cargo test

# Run specific crate tests
cargo test -p goose
cargo test -p goose-cli

# Run desktop app tests
cd ui/desktop && npm run test-e2e

# Run benchmarks
cargo bench
```

## Key Directories and Files

- `crates/goose/src/agents/`: Core agent logic and tool execution
- `crates/goose/src/providers/`: LLM provider implementations (OpenAI, Anthropic, etc.)
- `crates/goose/src/prompts/`: System prompts and templates
- `crates/goose-mcp/src/`: MCP server implementations for various tools
- `crates/goose-cli/src/commands/`: CLI command implementations
- `ui/desktop/src/`: Desktop application React components
- `documentation/`: Documentation website built with Docusaurus

## Environment Variables

Common environment variables for development:

```bash
# Provider configuration
GOOSE_PROVIDER=openai        # Change provider without reconfiguring
ANTHROPIC_API_KEY=...        # Direct API key setup
OPENAI_API_KEY=...
DATABRICKS_HOST=...

# Tracing and debugging
LANGFUSE_INIT_PROJECT_PUBLIC_KEY=...   # For Langfuse tracing
LANGFUSE_INIT_PROJECT_SECRET_KEY=...
```

## OpenAPI Schema Generation

The desktop app uses auto-generated TypeScript clients from OpenAPI specs:

```bash
just generate-openapi       # Regenerate schema and TypeScript client
```

The schema is generated by `crates/goose-server/src/bin/generate_schema.rs` and outputs to `ui/desktop/openapi.json`.

## Release Process

The project uses conventional commits and semantic versioning:

```bash
just prepare-release 1.2.0  # Prepare release branch and bump versions
just tag                   # Create git tag
just tag-push              # Push tag to trigger CI release
```

## Platform-Specific Builds

```bash
# Windows (cross-compilation)
just release-windows

# Intel Mac
just release-intel

# Platform-specific UI builds
just make-ui-windows
just make-ui-intel
```

## Development Tips

- Use `just` commands for common development tasks - they handle cross-platform differences and complex build steps
- The extension system is the primary way to add new capabilities - study existing extensions in `crates/goose-mcp/src/`
- Provider implementations follow a common pattern in `crates/goose/src/providers/`
- MCP (Model Context Protocol) is heavily used for tool integration
- Desktop app communicates with Rust backend via HTTP API defined in `goose-server`
- Follow conventional commit format for PR titles